(function(a){var b=function(e){var c=e.clone();var d=e.find("canvas");if(d.length){var f=c.find("canvas");f.each(function(g){var h=this.getContext("2d");h.drawImage(d.get(g),0,0)})}return c};a.fn.quicksand=function(g,c){var e={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",adjustWidth:"auto",useScaling:false,enhancement:function(h){},selector:"> *",atomic:false,dx:0,dy:0,maxWidth:0,retainExisting:true},f=(function(){var k="transform WebkitTransform MozTransform OTransform msTransform".split(" "),j=document.createElement("div");for(var h=0;h<k.length;h++){if(typeof j.style[k[h]]!="undefined"){return true}}return false})();a.extend(e,c);if(!f||(typeof(a.fn.scale)=="undefined")){e.useScaling=false}var d;if(typeof(arguments[1])=="function"){d=arguments[1]}else{if(typeof(arguments[2]=="function")){d=arguments[2]}}return this.each(function(A){var G;var D=[];var m;if(typeof(e.attribute)=="function"){m=a(g)}else{m=b(a(g).filter("["+e.attribute+"]"))}var E=a(this);var l=a(this).css("height");var v=a(this).css("width");var s,q;var n=false;var F=false;var o=a(E).offset();var p=[];var C=a(this).find(e.selector);var z=a(C).innerWidth();if(navigator.userAgent.match(/msie [6]/i)){E.html("").append(m);return}var r=0;var w=function(){a(this).css("margin","").css("position","").css("top","").css("left","").css("opacity","");if(!r){r=1;if(!e.atomic){var H=E.find(e.selector);if(!e.retainExisting){E.prepend(x.find(e.selector));H.remove()}else{var i=a([]);x.find(e.selector).each(function(I){var J=a([]);if(typeof(e.attribute)=="function"){var K=e.attribute(a(this));H.each(function(){if(e.attribute(this)==K){J=a(this);return false}})}else{J=H.filter("["+e.attribute+'="'+a(this).attr(e.attribute)+'"]')}if(J.length>0){i=i.add(J);if(I===0){E.prepend(J)}else{J.insertAfter(E.find(e.selector).get(I-1))}}});H.not(i).remove()}if(n){E.css("height",s)}if(F){E.css("width",v)}}e.enhancement(E);if(typeof d=="function"){d.call(this)}}if(false===e.adjustHeight){E.css("height","auto")}if(false===e.adjustWidth){E.css("width","auto")}};var B=E.offsetParent();var y=B.offset();if(B.css("position")=="relative"){if(B.get(0).nodeName.toLowerCase()!="body"){y.top+=(parseFloat(B.css("border-top-width"))||0);y.left+=(parseFloat(B.css("border-left-width"))||0)}}else{y.top-=(parseFloat(B.css("border-top-width"))||0);y.left-=(parseFloat(B.css("border-left-width"))||0);y.top-=(parseFloat(B.css("margin-top"))||0);y.left-=(parseFloat(B.css("margin-left"))||0)}if(isNaN(y.left)){y.left=0}if(isNaN(y.top)){y.top=0}y.left-=e.dx;y.top-=e.dy;E.css("height",a(this).height());E.css("width",a(this).width());C.each(function(H){p[H]=a(this).offset()});a(this).stop();var u=0;var t=0;C.each(function(H){a(this).stop();var I=a(this).get(0);if(I.style.position=="absolute"){u=-e.dx;t=-e.dy}else{u=e.dx;t=e.dy}I.style.position="absolute";I.style.margin="0";if(!e.adjustWidth){I.style.width=(z+"px")}I.style.top=(p[H].top-parseFloat(I.style.marginTop)-y.top+t)+"px";I.style.left=(p[H].left-parseFloat(I.style.marginLeft)-y.left+u)+"px";if(e.maxWidth>0&&p[H].left>e.maxWidth){I.style.display="none"}});var x=b(a(E));var j=x.get(0);j.innerHTML="";j.setAttribute("id","");j.style.height="auto";j.style.width=E.width()+"px";x.append(m);x.insertBefore(E);x.css("opacity",0);j.style.zIndex=-1;j.style.margin="0";j.style.position="absolute";j.style.top=o.top-y.top+"px";j.style.left=o.left-y.left+"px";if(e.adjustHeight==="dynamic"){E.animate({height:x.height()},e.duration,e.easing)}else{if(e.adjustHeight==="auto"){s=x.height();if(parseFloat(l)<parseFloat(s)){E.css("height",s)}else{n=true}}}if(e.adjustWidth==="dynamic"){E.animate({width:x.width()},e.duration,e.easing)}else{if(e.adjustWidth==="auto"){q=x.width();if(parseFloat(v)<parseFloat(q)){E.css("width",q)}else{F=true}}}C.each(function(H){var I=[];if(typeof(e.attribute)=="function"){G=e.attribute(a(this));m.each(function(){if(e.attribute(this)==G){I=a(this);return false}})}else{I=m.filter("["+e.attribute+'="'+a(this).attr(e.attribute)+'"]')}if(I.length){if(!e.useScaling){D.push({element:a(this),dest:I,style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{top:I.offset().top-y.top,left:I.offset().left-y.left,opacity:1}})}else{D.push({element:a(this),dest:I,style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{top:I.offset().top-y.top,left:I.offset().left-y.left,opacity:1,scale:"1.0"}})}}else{if(!e.useScaling){D.push({element:a(this),style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},animation:{opacity:"0.0"}})}else{D.push({element:a(this),animation:{opacity:"0.0",style:{top:a(this).offset().top,left:a(this).offset().left,opacity:""},scale:"0.0"}})}}});m.each(function(J){var I=[];var L=[];if(typeof(e.attribute)=="function"){G=e.attribute(a(this));C.each(function(){if(e.attribute(this)==G){I=a(this);return false}});m.each(function(){if(e.attribute(this)==G){L=a(this);return false}})}else{I=C.filter("["+e.attribute+'="'+a(this).attr(e.attribute)+'"]');L=m.filter("["+e.attribute+'="'+a(this).attr(e.attribute)+'"]')}var K;if(I.length===0&&L.length>0){if(!e.useScaling){K={opacity:"1.0"}}else{K={opacity:"1.0",scale:"1.0"}}var M=b(L);var H=M.get(0);H.style.position="absolute";H.style.margin="0";if(!e.adjustWidth){H.style.width=z+"px"}H.style.top=L.offset().top-y.top+"px";H.style.left=L.offset().left-y.left+"px";M.css("opacity",0);if(e.useScaling){M.scale(0)}M.appendTo(E);if(e.maxWidth===0||L.offset().left<e.maxWidth){D.push({element:a(M),dest:L,animation:K})}}});x.remove();if(!e.atomic){e.enhancement(E);for(A=0;A<D.length;A++){D[A].element.animate(D[A].animation,e.duration,e.easing,w)}}else{$toDelete=E.find(e.selector);E.prepend(x.find(e.selector));for(A=0;A<D.length;A++){if(D[A].dest&&D[A].style){var h=D[A].dest;var k=h.offset();h.css({position:"relative",top:(D[A].style.top-k.top),left:(D[A].style.left-k.left)});h.animate({top:"0",left:"0"},e.duration,e.easing,w)}else{D[A].element.animate(D[A].animation,e.duration,e.easing,w)}}$toDelete.remove()}})}})(jQuery);